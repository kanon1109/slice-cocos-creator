window.__require=function e(t,r,n){function i(s,c){if(!r[s]){if(!t[s]){var a=s.split("/");if(a=a[a.length-1],!t[a]){var h="function"==typeof __require&&__require;if(!c&&h)return h(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+s+"'")}s=a}var f=r[s]={exports:{}};t[s][0].call(f.exports,function(e){return i(t[s][1][e]||e)},f,f.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof __require&&__require,s=0;s<n.length;s++)i(n[s]);return i}({Slice:[function(e,t,r){"use strict";cc._RF.push(t,"d832apam25BaY+swLvFflyE","Slice");var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(r,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,a=s.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gameLayer=null,t.factor=30,t}return i(t,e),t.prototype.onLoad=function(){this.initPhysics()},t.prototype.start=function(){this.initEvent()},t.prototype.initPhysics=function(){var e=cc.director.getPhysicsManager();e.enabled=!0,e.gravity=new cc.Vec2(0,-50*this.factor),e.enabledAccumulator=!0,cc.PhysicsManager.FIXED_TIME_STEP=1/60,cc.PhysicsManager.VELOCITY_ITERATIONS=10,cc.PhysicsManager.POSITION_ITERATIONS=10},t.prototype.initEvent=function(){var e=this,t=this.getComponent(cc.Graphics);this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){t.clear();var r=e.getStartLocation();t.moveTo(r.x,r.y),t.lineTo(e.getLocationX(),e.getLocationY()),t.stroke()},this),this.node.on(cc.Node.EventType.TOUCH_END,function(r){t.clear();var n=r.getStartLocation(),i=r.getLocation();e.cut(n,i)},this)},t.prototype.cut=function(e,t){var r=cc.director.getPhysicsManager().rayCast(e,t,cc.RayCastType.All),n=cc.director.getPhysicsManager().rayCast(t,e,cc.RayCastType.All);n.forEach(function(e){e.fraction=1-e.fraction});for(var i=r.concat(n),o=[],s=function(e){var t=!1,r=i[e];if(!(r.collider instanceof cc.PhysicsPolygonCollider))return"continue";for(var n=0;n<o.length;n++){var s=o[n];if(s[0]&&r.collider===s[0].collider){t=!0;var c=s.find(function(e){return e.point.sub(r.point).magSqr()<=5});c?s.splice(s.indexOf(c),1):s.push(r);break}}t||o.push([r])},c=0;c<i.length;c++)s(c);for(cc.log(o),c=0;c<o.length;c++){var a=o[c];if(!(a.length<2)){a=a.sort(function(e,t){return e.fraction>t.fraction?1:e.fraction<t.fraction?-1:0}),cc.log(a);for(var h=[],f=0;f<a.length-1;f+=2){var u=a[f],p=a[f+1];u&&p&&this.split(u.collider,u.point,p.point,h)}if(!(h.length<=0)){var l=a[0].collider,v=void 0;for(f=0;f<h.length;f++){for(var d=h[f],y=0;y<d.length;y++)"number"==typeof d[y]&&(d[y]=l.points[d[y]]);(!v||d.length>v.length)&&(v=d)}if(!(v.length<3))for(l.points=v,l.apply(),l.node.getComponent("mesh-texture-mask").vertexes=v,f=0;f<h.length;f++)if(!((d=h[f]).length<3)&&d!=v){var g=cc.instantiate(l.node);this.gameLayer.addChild(g);var _=g.getComponent(cc.PhysicsPolygonCollider);_.points=d,_.apply();var m=g.getComponent("mesh-texture-mask");m.vertexes=d,m.onLoad()}}}}},t.prototype.pointInLine=function(e,t,r){return cc.Intersection.pointLineDistance(e,t,r,!0)<1},t.prototype.split=function(e,t,r,n){var i=e.body,o=e.points,s=cc.Vec2.ZERO,c=cc.Vec2.ZERO;i.getLocalPoint(t,s),i.getLocalPoint(r,c);for(var a=[s,c],h=[c,s],f=void 0,u=void 0,p=0;p<o.length;p++){var l=o[p],v=p===o.length-1?o[0]:o[p+1];if(this.pointInLine(s,l,v)&&(f=p),this.pointInLine(c,l,v)&&(u=p),void 0!==f&&void 0!==u)break}var d=void 0,y=f,g=u;if(n.length>0)for(p=0;p<n.length;p++){var _=n[p];if(y=_.indexOf(f),g=_.indexOf(u),-1!==y&&-1!==g){d=n.splice(p,1)[0];break}}for(d||(d=o.map(function(e,t){return t})),p=y+1;p!==g+1;p++)p>=d.length&&(p=0),(m="number"==typeof(m=d[p])?o[m]:m).sub(s).magSqr()<5||m.sub(c).magSqr()<5||h.push(d[p]);for(p=g+1;p!==y+1;p++){var m;p>=d.length&&(p=0),(m="number"==typeof(m=d[p])?o[m]:m).sub(s).magSqr()<5||m.sub(c).magSqr()<5||a.push(d[p])}n.push(a),n.push(h)},o([a(cc.Node)],t.prototype,"gameLayer",void 0),o([c],t)}(cc.Component);r.default=h,cc._RF.pop()},{}],"mesh-texture-mask":[function(e,t){"use strict";function r(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=n(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}function n(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}cc._RF.push(t,"78199njtHVD55/l6nO/BEZt","mesh-texture-mask");var o=cc.gfx;cc.Class({extends:cc.Component,editor:!1,properties:{_temp_refresh:!1,temp_refresh:{displayName:"\u7f16\u8f91\u5668\u81ea\u52a8\u5237\u65b0\u6548\u679c",type:cc.Boolean,get:function(){return this._temp_refresh},set:function(e){this._temp_refresh=e,this._applyVertexes()}},_offset:cc.v2(0,0),offset:{get:function(){return this._offset},set:function(e){this._offset=e,this.temp_refresh,this._applyVertexes()},type:cc.Vec2},_spriteFrame:{default:null,type:cc.SpriteFrame},spriteFrame:{get:function(){return this._spriteFrame},set:function(e){this._spriteFrame=e,this._applySpriteFrame()},type:cc.SpriteFrame},_vertexes:{default:[],type:[cc.Vec2]},vertexes:{tooltip:"\u591a\u8fb9\u5f62\u9876\u70b9\u6570\u7ec4(\u81f3\u5c11\u4e09\u4e2a)",get:function(){return this._vertexes},set:function(e){this._vertexes=e,this._updateMesh(),this.temp_refresh,this._applyVertexes()},type:[cc.Vec2]}},onLoad:function(){this._meshCache={},this._updateMesh();var e=this.node.getComponent(cc.MeshRenderer);e||(e=this.node.addComponent(cc.MeshRenderer)),e.mesh=null,this.renderer=e;var t=cc.Material.getBuiltinMaterial("unlit",this);e.setMaterial(0,t),this._applySpriteFrame(),this._applyVertexes()},_updateMesh:function(){var e=this._meshCache[this.vertexes.length];e||((e=new cc.Mesh).init(new o.VertexFormat([{name:o.ATTR_POSITION,type:o.ATTR_TYPE_FLOAT32,num:2},{name:o.ATTR_UV0,type:o.ATTR_TYPE_FLOAT32,num:2}]),this.vertexes.length,!0),this._meshCache[this.vertexes.length]=e),this.mesh=e},_applyVertexes:function(){var e=this,t=this.mesh;if(t.setVertices(o.ATTR_POSITION,this.vertexes),this.texture){for(var n,i=[],s=r(this.vertexes);!(n=s()).done;){var c=n.value,a=(c.x+this.texture.width/2+this.offset.x)/this.texture.width,h=1-(c.y+this.texture.height/2+this.offset.y)/this.texture.height;i.push(cc.v2(a,h))}t.setVertices(o.ATTR_UV0,i)}if(this.vertexes.length>=3){for(var f=[],u=[].concat(this.vertexes),p=0,l=-1;u.length>3;){var v=u[p],d=u[(p+1)%u.length],y=u[(p+2)%u.length],g=d.sub(v),_=y.sub(d);if(g.cross(_)>=0){for(var m,x=!1,b=r(u);!(m=b()).done;){var T=m.value;if(T!==v&&T!==d&&T!==y&&this._testInTriangle(T,v,d,y)){x=!0;break}}if(x){if((p=(p+1)%u.length)===l){cc.log("\u5faa\u73af\u4e00\u5708\u672a\u53d1\u73b0");break}}else f=f.concat([this.vertexes.indexOf(v),this.vertexes.indexOf(d),this.vertexes.indexOf(y)]),u.splice(u.indexOf(d),1),l=p}else if((p=(p+1)%u.length)===l){cc.log("\u5faa\u73af\u4e00\u5708\u672a\u53d1\u73b0");break}p>u.length-1&&(p=u.length-1)}f=f.concat(u.map(function(t){return e.vertexes.indexOf(t)})),t.setIndices(f),this.renderer.mesh!=t&&(this.renderer.mesh=t)}},_testInTriangle:function(e,t,r,n){var i=r.sub(t),o=n.sub(t),s=n.sub(r),c=e.sub(t),a=e.sub(r);return i.cross(o)>=0^i.cross(c)<0&&i.cross(o)>=0^o.cross(c)>=0&&s.cross(i)>0^s.cross(a)>=0},_applySpriteFrame:function(){if(this.spriteFrame){var e=this.renderer._materials[0],t=this.spriteFrame.getTexture();e.define("USE_DIFFUSE_TEXTURE",!0),e.setProperty("diffuseTexture",t),this.texture=t}}}),cc._RF.pop()},{}]},{},["Slice","mesh-texture-mask"]);